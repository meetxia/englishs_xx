<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç‰›æ´¥è¯å…¸éŸ³é¢‘æµ‹è¯•</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold text-center mb-8">ç‰›æ´¥è¯å…¸éŸ³é¢‘æµ‹è¯•</h1>
        
        <!-- å‘éŸ³è®¾ç½® -->
        <div class="bg-white p-6 rounded-lg shadow-md mb-6">
            <h2 class="text-xl font-semibold mb-4">å‘éŸ³è®¾ç½®</h2>
            <div class="flex gap-4 mb-4">
                <label class="inline-flex items-center">
                    <input type="radio" name="test-accent" value="gb" class="form-radio text-red-500" checked>
                    <span class="ml-2">ğŸ‡¬ğŸ‡§ è‹±å¼å‘éŸ³</span>
                </label>
                <label class="inline-flex items-center">
                    <input type="radio" name="test-accent" value="us" class="form-radio text-blue-500">
                    <span class="ml-2">ğŸ‡ºğŸ‡¸ ç¾å¼å‘éŸ³</span>
                </label>
            </div>
            <label class="inline-flex items-center">
                <input type="checkbox" id="test-fallback" class="form-checkbox text-green-500" checked>
                <span class="ml-2">å¯ç”¨TTSå¤‡ç”¨å‘éŸ³</span>
            </label>
        </div>

        <!-- æµ‹è¯•å•è¯ -->
        <div class="bg-white p-6 rounded-lg shadow-md mb-6">
            <h2 class="text-xl font-semibold mb-4">æµ‹è¯•å•è¯</h2>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <button onclick="testPronounce('hello')" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">
                    ğŸ”Š hello
                </button>
                <button onclick="testPronounce('world')" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">
                    ğŸ”Š world
                </button>
                <button onclick="testPronounce('pronunciation')" class="bg-purple-500 text-white px-4 py-2 rounded hover:bg-purple-600">
                    ğŸ”Š pronunciation
                </button>
                <button onclick="testPronounce('beautiful')" class="bg-pink-500 text-white px-4 py-2 rounded hover:bg-pink-600">
                    ğŸ”Š beautiful
                </button>
                <button onclick="testPronounce('education')" class="bg-indigo-500 text-white px-4 py-2 rounded hover:bg-indigo-600">
                    ğŸ”Š education
                </button>
                <button onclick="testPronounce('technology')" class="bg-yellow-500 text-white px-4 py-2 rounded hover:bg-yellow-600">
                    ğŸ”Š technology
                </button>
                <button onclick="testPronounce('important')" class="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600">
                    ğŸ”Š important
                </button>
                <button onclick="testPronounce('development')" class="bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600">
                    ğŸ”Š development
                </button>
            </div>
        </div>

        <!-- è‡ªå®šä¹‰æµ‹è¯• -->
        <div class="bg-white p-6 rounded-lg shadow-md mb-6">
            <h2 class="text-xl font-semibold mb-4">è‡ªå®šä¹‰æµ‹è¯•</h2>
            <div class="flex gap-2">
                <input type="text" id="custom-word" placeholder="è¾“å…¥è¦æµ‹è¯•çš„å•è¯" 
                       class="flex-1 px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500">
                <button onclick="testCustomWord()" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">
                    ğŸ”Š æµ‹è¯•å‘éŸ³
                </button>
            </div>
        </div>

        <!-- æ–‡ä»¶è·¯å¾„æ£€æµ‹ -->
        <div class="bg-white p-6 rounded-lg shadow-md mb-6">
            <h2 class="text-xl font-semibold mb-4">æ–‡ä»¶è·¯å¾„æ£€æµ‹</h2>
            <div class="mb-4">
                <p class="text-sm text-gray-700 mb-2">æ­¤åŠŸèƒ½å¯å¸®åŠ©æ£€æµ‹éŸ³é¢‘æ–‡ä»¶æ˜¯å¦å¯è®¿é—®</p>
                <input type="text" id="file-path-input" value="/data/yinpin/hello_gb.mp3" 
                       class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 mb-2">
                <div class="flex gap-2">
                    <button onclick="checkFilePath()" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">
                        æ£€æŸ¥æ–‡ä»¶è·¯å¾„
                    </button>
                    <button onclick="openAudioFile()" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">
                        ç›´æ¥æ‰“å¼€éŸ³é¢‘
                    </button>
                </div>
            </div>
            <div id="file-test-result" class="bg-gray-50 p-3 rounded border text-sm">
                ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®æµ‹è¯•æ–‡ä»¶è·¯å¾„...
            </div>
        </div>

        <!-- çŠ¶æ€æ˜¾ç¤º -->
        <div class="bg-white p-6 rounded-lg shadow-md">
            <h2 class="text-xl font-semibold mb-4">çŠ¶æ€ä¿¡æ¯</h2>
            <div id="status-display" class="bg-gray-50 p-4 rounded border min-h-[100px] font-mono text-sm">
                ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®æµ‹è¯•å‘éŸ³åŠŸèƒ½...
            </div>
        </div>
    </div>

    <script>
        // å‘éŸ³è®¾ç½®
        let testSettings = {
            accent: 'gb',
            fallbackToTTS: true
        };

        // è·å–æœ¬åœ°éŸ³é¢‘æ–‡ä»¶è·¯å¾„
        function getLocalAudioPath(word, accent = null) {
            const selectedAccent = accent || testSettings.accent;
            const fileName = `${word.toLowerCase()}_${selectedAccent}.mp3`;
            return `/audio/${fileName}`; // ä¿®æ”¹ä¸ºä½¿ç”¨public/audioç›®å½•ä¸‹çš„éŸ³é¢‘æ–‡ä»¶
        }

        // æ’­æ”¾æœ¬åœ°éŸ³é¢‘æ–‡ä»¶
        function playLocalAudio(word, accent = null) {
            return new Promise((resolve, reject) => {
                const audioPath = getLocalAudioPath(word, accent);
                const audio = new Audio();
                
                logStatus(`å°è¯•æ’­æ”¾æœ¬åœ°éŸ³é¢‘: ${audioPath}`);
                
                // æ·»åŠ è¯¦ç»†çš„é”™è¯¯å¤„ç†
                audio.onerror = (event) => {
                    const errorDetails = {
                        code: audio.error ? audio.error.code : 'unknown',
                        message: audio.error ? audio.error.message : 'unknown',
                        details: JSON.stringify(event)
                    };
                    logStatus(`âŒ æœ¬åœ°éŸ³é¢‘åŠ è½½å¤±è´¥: ${JSON.stringify(errorDetails)}`);
                    reject(new Error(`éŸ³é¢‘åŠ è½½å¤±è´¥: ${errorDetails.message}`));
                };
                
                audio.onloadeddata = () => {
                    logStatus(`âœ… æœ¬åœ°éŸ³é¢‘åŠ è½½æˆåŠŸ: ${word} (${accent || testSettings.accent})`);
                    audio.play()
                        .then(() => {
                            logStatus(`âœ… æœ¬åœ°éŸ³é¢‘æ’­æ”¾æˆåŠŸ: ${word} (${accent || testSettings.accent})`);
                            resolve();
                        })
                        .catch(error => {
                            logStatus(`âŒ æœ¬åœ°éŸ³é¢‘æ’­æ”¾å¤±è´¥: ${error.message}`);
                            reject(error);
                        });
                };
                
                // å…ˆæ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
                fetch(audioPath, { method: 'HEAD' })
                    .then(response => {
                        if (!response.ok) {
                            throw new Error(`æ–‡ä»¶ä¸å­˜åœ¨æˆ–æ— æ³•è®¿é—® (HTTP ${response.status})`);
                        }
                        logStatus(`âœ… æ–‡ä»¶æ£€æŸ¥æˆåŠŸ: ${audioPath}`);
                        // æ–‡ä»¶å­˜åœ¨ï¼Œè®¾ç½®éŸ³é¢‘æº
                        audio.src = audioPath;
                    })
                    .catch(error => {
                        logStatus(`âŒ æ–‡ä»¶æ£€æŸ¥å¤±è´¥: ${error.message}`);
                        reject(error);
                    });
                
                // è®¾ç½®è¶…æ—¶
                setTimeout(() => {
                    if (audio.readyState === 0) {
                        reject(new Error('éŸ³é¢‘åŠ è½½è¶…æ—¶'));
                    }
                }, 5000); // å¢åŠ è¶…æ—¶æ—¶é—´åˆ°5ç§’
            });
        }

        // æµ‹è¯•å‘éŸ³å‡½æ•°
        async function testPronounce(word) {
            logStatus(`\n=== å¼€å§‹æµ‹è¯•å•è¯: ${word} ===`);
            logStatus(`å½“å‰è®¾ç½®: ${testSettings.accent === 'gb' ? 'è‹±å¼' : 'ç¾å¼'}å‘éŸ³, TTSå¤‡ç”¨: ${testSettings.fallbackToTTS ? 'å¯ç”¨' : 'ç¦ç”¨'}`);
            
            try {
                await playLocalAudio(word);
                logStatus(`âœ… å‘éŸ³æµ‹è¯•æˆåŠŸ: ${word}`);
            } catch (error) {
                logStatus(`âŒ æœ¬åœ°éŸ³é¢‘å¤±è´¥: ${error.message}`);
                
                if (testSettings.fallbackToTTS) {
                    logStatus(`å°è¯•TTSå¤‡ç”¨å‘éŸ³...`);
                    // è¿™é‡Œå¯ä»¥æ·»åŠ TTSæµ‹è¯•ä»£ç 
                    logStatus(`TTSåŠŸèƒ½éœ€è¦å®Œæ•´çš„main.jsæ”¯æŒ`);
                }
            }
        }

        // è‡ªå®šä¹‰å•è¯æµ‹è¯•
        function testCustomWord() {
            const word = document.getElementById('custom-word').value.trim();
            if (word) {
                testPronounce(word);
            } else {
                logStatus('è¯·è¾“å…¥è¦æµ‹è¯•çš„å•è¯');
            }
        }

        // æ–‡ä»¶è·¯å¾„æ£€æµ‹å‡½æ•°
        function checkFilePath() {
            const filePath = document.getElementById('file-path-input').value.trim();
            const resultDiv = document.getElementById('file-test-result');
            
            resultDiv.innerHTML = `æ­£åœ¨æ£€æŸ¥æ–‡ä»¶: ${filePath}...`;
            
            fetch(filePath, { method: 'HEAD' })
                .then(response => {
                    if (response.ok) {
                        resultDiv.innerHTML = `<span class="text-green-600">âœ… æ–‡ä»¶å­˜åœ¨! HTTPçŠ¶æ€: ${response.status}</span>`;
                        return response.headers;
                    } else {
                        resultDiv.innerHTML = `<span class="text-red-600">âŒ æ–‡ä»¶ä¸å­˜åœ¨æˆ–æ— æ³•è®¿é—®! HTTPçŠ¶æ€: ${response.status}</span>`;
                        throw new Error(`HTTPé”™è¯¯ ${response.status}`);
                    }
                })
                .then(headers => {
                    // æ˜¾ç¤ºå¤´ä¿¡æ¯
                    let headerText = '<div class="mt-2"><strong>å“åº”å¤´ä¿¡æ¯:</strong><ul>';
                    headers.forEach((value, key) => {
                        headerText += `<li>${key}: ${value}</li>`;
                    });
                    headerText += '</ul></div>';
                    resultDiv.innerHTML += headerText;
                })
                .catch(error => {
                    resultDiv.innerHTML += `<div class="text-red-600 mt-2">âŒ é”™è¯¯: ${error.message}</div>`;
                });
        }

        // ç›´æ¥æ‰“å¼€éŸ³é¢‘æ–‡ä»¶
        function openAudioFile() {
            const filePath = document.getElementById('file-path-input').value.trim();
            window.open(filePath, '_blank');
        }

        // è®°å½•çŠ¶æ€
        function logStatus(message) {
            const display = document.getElementById('status-display');
            display.textContent += message + '\n';
            display.scrollTop = display.scrollHeight;
            console.log(message);
        }

        // åˆå§‹åŒ–äº‹ä»¶ç›‘å¬å™¨
        document.addEventListener('DOMContentLoaded', () => {
            // å‘éŸ³ç±»å‹é€‰æ‹©
            const accentRadios = document.querySelectorAll('input[name="test-accent"]');
            accentRadios.forEach(radio => {
                radio.addEventListener('change', (e) => {
                    if (e.target.checked) {
                        testSettings.accent = e.target.value;
                        logStatus(`å‘éŸ³ç±»å‹å·²åˆ‡æ¢ä¸º: ${testSettings.accent === 'gb' ? 'è‹±å¼' : 'ç¾å¼'}`);
                    }
                });
            });

            // TTSå¤‡ç”¨é€‰é¡¹
            const fallbackCheckbox = document.getElementById('test-fallback');
            fallbackCheckbox.addEventListener('change', (e) => {
                testSettings.fallbackToTTS = e.target.checked;
                logStatus(`TTSå¤‡ç”¨é€‰é¡¹: ${testSettings.fallbackToTTS ? 'å·²å¯ç”¨' : 'å·²ç¦ç”¨'}`);
            });

            // å›è½¦é”®æµ‹è¯•
            document.getElementById('custom-word').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    testCustomWord();
                }
            });

            logStatus('éŸ³é¢‘æµ‹è¯•é¡µé¢å·²åŠ è½½å®Œæˆ');
        });
    </script>
</body>
</html>
